[
    {
        "role": "user",
        "content": "###main.tf###\nresource \"random_pet\" \"rg_name\" {\n  prefix = var.resource_group_name_prefix\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  name     = random_pet.rg_name.id\n  location = var.resource_group_location\n}\n\nresource \"random_string\" \"name\" {\n  length  = 13\n  lower   = true\n  numeric = false\n  special = false\n  upper   = false\n}\n\nresource \"azurerm_dns_zone\" \"zone\" {\n  name                = \"www.${random_string.name.result}.azurequickstart.org\"\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource \"azurerm_dns_a_record\" \"record\" {\n  name                = \"www\"\n  resource_group_name = azurerm_resource_group.rg.name\n  zone_name           = azurerm_dns_zone.zone.name\n  ttl                 = 3600\n  records             = [\"1.2.3.4\", \"1.2.3.5\"]\n}\n\nmain.tf:end\n###outputs.tf###\noutput \"name_servers\" {\n  value = azurerm_dns_zone.zone.name_servers\n}\n\noutputs.tf:end\n###providers.tf###\nterraform {\n  required_version = \">=0.12\"\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~>2.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~>3.0\"\n    }\n  }\n}\nprovider \"azurerm\" {\n  features {}\n}\nproviders.tf:end\n###variables.tf###\nvariable \"resource_group_location\" {\n  default     = \"eastus\"\n  description = \"Location for all resources.\"\n}\n\nvariable \"resource_group_name_prefix\" {\n  default     = \"rg\"\n  description = \"Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription.\"\n}\n\nvariables.tf:end\n"
    },
    {
        "role": "assistant",
        "content": "###main.tf###\nresource \"random_pet\" \"rg_name\" {\n  prefix = var.resource_group_name_prefix\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  name     = random_pet.rg_name.id\n  location = var.resource_group_location\n}\n\nresource \"random_string\" \"azurerm_dns_zone_name\" {\n  length  = 13\n  lower   = true\n  numeric = false\n  special = false\n  upper   = false\n}\n\nresource \"azurerm_dns_zone\" \"zone\" {\n  name = (\n    var.dns_zone_name != null ?\n    var.dns_zone_name :\n    \"www.${random_string.azurerm_dns_zone_name.result}.azurequickstart.org\"\n  )\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource \"azurerm_dns_a_record\" \"record\" {\n  name                = \"www\"\n  resource_group_name = azurerm_resource_group.rg.name\n  zone_name           = azurerm_dns_zone.zone.name\n  ttl                 = var.dns_ttl\n  records             = var.dns_records\n}\n\nmain.tf:end\n###outputs.tf###\noutput \"resource_group_name\" {\n  value = azurerm_resource_group.rg.name\n}\n\noutput \"dns_zone_name\" {\n  value = azurerm_dns_zone.zone.name\n}\n\noutput \"name_servers\" {\n  value = azurerm_dns_zone.zone.name_servers\n}\n\noutputs.tf:end\n###providers.tf###\nterraform {\n  required_version = \">=1.2\"\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~>3.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~>3.0\"\n    }\n  }\n}\nprovider \"azurerm\" {\n  features {}\n}\nproviders.tf:end\n###readme.md###\n# Azure DNS zone and A record\n\nThis template creates an Azure DNS zone and an 'A' record.\n\n## Terraform resource types\n\n- [random_pet](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet)\n- [azurerm_resource_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)\n- [random_string](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string)\n- [azurerm_dns_zone](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dns_zone)\n- [azurerm_dns_a_record](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dns_a_record)\n\n## Variables\n\n| Name | Description | Default |\n|-|-|-|\n| `resource_group_name_prefix` | Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription. | rg |\n| `resource_group_location` | Location of the resource group. | eastus |\n| `dns_zone_name` | Name of the DNS zone. | null |\n| `dns_ttl` | Time To Live (TTL) of the DNS record (in seconds). | 3600 |\n| `dns_records` | List of IPv4 addresses. | [\"1.2.3.4\", \"1.2.3.5\"] |\n\n## Example\n\nTo see how to run this example, see [Create an Azure resource group using Terraform](https://docs.microsoft.com/azure/developer/terraform/create-resource-group).\n\nreadme.md:end\n###variables.tf###\nvariable \"resource_group_location\" {\n  type        = string\n  default     = \"eastus\"\n  description = \"Location for all resources.\"\n}\n\nvariable \"resource_group_name_prefix\" {\n  type        = string\n  default     = \"rg\"\n  description = \"Prefix of the resource group name that's combined with a random value so name is unique in your Azure subscription.\"\n}\n\nvariable \"dns_zone_name\" {\n  type        = string\n  default     = null\n  description = \"Name of the DNS zone.\"\n}\n\nvariable \"dns_ttl\" {\n  type        = number\n  default     = 3600\n  description = \"Time To Live (TTL) of the DNS record (in seconds).\"\n}\n\nvariable \"dns_records\" {\n  type        = list(string)\n  default     = [\"1.2.3.4\", \"1.2.3.5\"]\n  description = \"List of IPv4 addresses.\"\n}\n\nvariables.tf:end\n"
    },
    {
        "role": "user",
        "content": "###main.tf###\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nprovider \"azurerm\" {\n  features {}\n}\n\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"${var.prefix}-resources\"\n  location = var.location\n}\n\nresource \"azurerm_virtual_network\" \"example\" {\n  name                = \"batch-custom-img-vnet\"\n  address_space       = [\"10.0.0.0/16\"]\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n}\n\nresource \"azurerm_subnet\" \"example\" {\n  name                 = \"internal\"\n  resource_group_name  = azurerm_resource_group.example.name\n  virtual_network_name = azurerm_virtual_network.example.name\n  address_prefixes     = [\"10.0.2.0/24\"]\n}\n\nresource \"azurerm_public_ip\" \"example\" {\n  name                = \"batch-custom-img-ip\"\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n  allocation_method   = \"Dynamic\"\n  domain_name_label   = \"batch-custom-img\"\n}\n\nresource \"azurerm_network_interface\" \"example\" {\n  name                = \"batch-custom-img-nic\"\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n\n  ip_configuration {\n    name                          = \"exampleconfigurationsource\"\n    subnet_id                     = azurerm_subnet.example.id\n    private_ip_address_allocation = \"Dynamic\"\n    public_ip_address_id          = azurerm_public_ip.example.id\n  }\n}\n\nresource \"azurerm_storage_account\" \"example\" {\n  name                     = \"batchcustomimgstore\"\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = azurerm_resource_group.example.location\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n\n  tags = {\n    environment = \"Dev\"\n  }\n}\n\nresource \"azurerm_storage_container\" \"example\" {\n  name                  = \"vhds\"\n  storage_account_name  = azurerm_storage_account.example.name\n  container_access_type = \"blob\"\n}\n\nresource \"azurerm_virtual_machine\" \"example\" {\n  name                  = \"batch-custom-img-vm\"\n  location              = azurerm_resource_group.example.location\n  resource_group_name   = azurerm_resource_group.example.name\n  network_interface_ids = [\"${azurerm_network_interface.example.id}\"]\n  vm_size               = \"Standard_D1_v2\"\n\n  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = \"latest\"\n  }\n\n  storage_os_disk {\n    name          = \"myosdisk1\"\n    vhd_uri       = \"${azurerm_storage_account.example.primary_blob_endpoint}${azurerm_storage_container.example.name}/myosdisk1.vhd\"\n    caching       = \"ReadWrite\"\n    create_option = \"FromImage\"\n    disk_size_gb  = \"30\"\n  }\n\n  os_profile {\n    computer_name  = \"batch-custom-img-vm\"\n    admin_username = \"tfuser\"\n    admin_password = \"P@ssW0RD7890\"\n  }\n\n  os_profile_linux_config {\n    disable_password_authentication = false\n  }\n\n  tags = {\n    environment = \"Dev\"\n    cost-center = \"Ops\"\n  }\n}\n\nresource \"azurerm_image\" \"example\" {\n  name                = \"batch-custom-img\"\n  location            = azurerm_resource_group.example.location\n  resource_group_name = azurerm_resource_group.example.name\n\n  os_disk {\n    os_type  = \"Linux\"\n    os_state = \"Generalized\"\n    blob_uri = azurerm_virtual_machine.example.storage_os_disk.0.vhd_uri\n    size_gb  = 30\n    caching  = \"None\"\n  }\n\n  tags = {\n    environment = \"Dev\"\n    cost-center = \"Ops\"\n  }\n}\nresource \"azurerm_batch_account\" \"example\" {\n  name                = \"${var.prefix}batch\"\n  resource_group_name = azurerm_resource_group.example.name\n  location            = azurerm_resource_group.example.location\n}\n\nresource \"azurerm_batch_pool\" \"example\" {\n  name                = \"${var.prefix}-custom-img-pool\"\n  resource_group_name = azurerm_resource_group.example.name\n  account_name        = azurerm_batch_account.example.name\n  display_name        = \"Custom Img Pool\"\n  vm_size             = \"Standard_A1\"\n  node_agent_sku_id   = \"batch.node.ubuntu 22.04\"\n\n  fixed_scale {\n    target_dedicated_nodes = 2\n    resize_timeout         = \"PT15M\"\n  }\n\n  storage_image_reference {\n    id = azurerm_image.example.id\n  }\n}\n\nmain.tf:end\n###README.md###\n## Example: Azure Batch with custom image\n\nThis example provisions the following Resources:\n\n## Creates\n\n1. A Resource Group\n2. A [Batch Account](https://docs.microsoft.com/en-us/azure/batch/batch-api-basics#account)\n3. A Custom Virtual Machine image to be used by the Azure Batch Pool\n4. A [Batch pool that uses a custom VM image for virtual machines](https://docs.microsoft.com/en-us/azure/batch/batch-custom-images)\n\n## Usage\n\n- Provide values to all variables (credentials and names).\n- Create with `terraform apply`\n- Destroy all with `terraform destroy --force`\n\nREADME.md:end\n###variables.tf###\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nvariable \"prefix\" {\n  description = \"The prefix which should be used for all resources in this example\"\n}\n\nvariable \"location\" {\n  description = \"The Azure Region in which all resources in this example should be created.\"\n}\n\nvariables.tf:end\n"
    }
]