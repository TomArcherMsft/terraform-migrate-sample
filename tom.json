[
    {
        "role": "user",
        "content": "\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nprovider \"azurerm\" {\n  features {}\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  name     = \"${var.prefix}-resources\"\n  location = var.location\n}\n\nresource \"azurerm_api_management\" \"apim_service\" {\n  name                = \"${var.prefix}-apim-service\"\n  location            = var.location\n  resource_group_name = azurerm_resource_group.rg.name\n  publisher_name      = \"Example Publisher\"\n  publisher_email     = \"publisher@example.com\"\n  sku_name            = \"Developer_1\"\n  tags = {\n    Environment = \"Example\"\n  }\n  policy {\n    xml_content = <<XML\n    <policies>\n      <inbound />\n      <backend />\n      <outbound />\n      <on-error />\n    </policies>\nXML\n  }\n}\n\nresource \"azurerm_api_management_api\" \"api\" {\n  name                = \"${var.prefix}-api\"\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  revision            = \"1\"\n  display_name        = \"${var.prefix}-api\"\n  path                = \"example\"\n  protocols           = [\"https\", \"http\"]\n  description         = \"An example API\"\n  import {\n    content_format = var.open_api_spec_content_format\n    content_value  = var.open_api_spec_content_value\n  }\n}\n\nresource \"azurerm_api_management_product\" \"product\" {\n  product_id            = \"${var.prefix}-product\"\n  resource_group_name   = azurerm_resource_group.rg.name\n  api_management_name   = azurerm_api_management.apim_service.name\n  display_name          = \"${var.prefix}-product\"\n  subscription_required = true\n  approval_required     = false\n  published             = true\n  description           = \"An example Product\"\n}\n\nresource \"azurerm_api_management_group\" \"group\" {\n  name                = \"${var.prefix}-group\"\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  display_name        = \"${var.prefix}-group\"\n  description         = \"An example group\"\n}\n\nresource \"azurerm_api_management_product_api\" \"product_api\" {\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  product_id          = azurerm_api_management_product.product.product_id\n  api_name            = azurerm_api_management_api.api.name\n}\n\nresource \"azurerm_api_management_product_group\" \"product_group\" {\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  product_id          = azurerm_api_management_product.product.product_id\n  group_name          = azurerm_api_management_group.group.name\n}\n\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\noutput \"service_id\" {\n  description = \"The ID of the API Management Service created\"\n  value       = azurerm_api_management.apim_service.id\n}\n\noutput \"gateway_url\" {\n  description = \"The URL of the Gateway for the API Management Service\"\n  value       = azurerm_api_management.apim_service.gateway_url\n}\n\noutput \"service_public_ip_addresses\" {\n  description = \"The Public IP addresses of the API Management Service\"\n  value       = azurerm_api_management.apim_service.public_ip_addresses\n}\n\noutput \"api_outputs\" {\n  description = \"The IDs, state, and version outputs of the APIs created\"\n  value = {\n    id             = azurerm_api_management_api.api.id\n    is_current     = azurerm_api_management_api.api.is_current\n    is_online      = azurerm_api_management_api.api.is_online\n    version        = azurerm_api_management_api.api.version\n    version_set_id = azurerm_api_management_api.api.version_set_id\n  }\n}\n\noutput \"product_ids\" {\n  description = \"The ID of the Product created\"\n  value       = azurerm_api_management_product.product.id\n}\n\noutput \"product_api_ids\" {\n  description = \"The ID of the Product/API association created\"\n  value       = azurerm_api_management_product_api.product_api.id\n}\n\noutput \"product_group_ids\" {\n  description = \"The ID of the Product/Group association created\"\n  value       = azurerm_api_management_product_group.product_group.id\n}\n\n## Example: API Management\n\nThis example provisions an API Management service, containing an API based on a provided Open API spec, a Group, and a Product that is associated with both.\n\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nvariable \"prefix\" {\n  description = \"The prefix which should be used for all resources in this example\"\n}\n\nvariable \"location\" {\n  description = \"The Azure Region in which all resources in this example should be created.\"\n}\n\nvariable \"open_api_spec_content_format\" {\n  description = \"The format of the content from which the API Definition should be imported. Possible values are: openapi, openapi+json, openapi+json-link, openapi-link, swagger-json, swagger-link-json, wadl-link-json, wadl-xml, wsdl and wsdl-link.\"\n}\n\nvariable \"open_api_spec_content_value\" {\n  description = \"The Content from which the API Definition should be imported. When a content_format of *-link-* is specified this must be a URL, otherwise this must be defined inline.\"\n}"
    },
    {
        "role": "assistant",
        "content": "###main.tf###\nresource \"random_pet\" \"rg_name\" {\n  prefix = var.resource_group_name_prefix\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  location = var.resource_group_location\n  name     = random_pet.rg_name.id\n}\n\nresource \"random_pet\" \"api_management\" {\n}\n\nresource \"azurerm_api_management\" \"apim_service\" {\n  name                = \"${random_pet.api_management.id}-apim-service\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n  publisher_name      = \"Example Publisher\"\n  publisher_email     = \"publisher@example.com\"\n  sku_name            = \"Developer_1\"\n  tags = {\n    Environment = \"Example\"\n  }\n  policy {\n    xml_content = <<XML\n    <policies>\n      <inbound />\n      <backend />\n      <outbound />\n      <on-error />\n    </policies>\nXML\n  }\n}\n\nresource \"azurerm_api_management_api\" \"api\" {\n  name                = \"${random_pet.api_management.id}-api\"\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  revision            = \"1\"\n  display_name        = \"${random_pet.api_management.id}-api\"\n  path                = \"example\"\n  protocols           = [\"https\", \"http\"]\n  description         = \"An example API\"\n  import {\n    content_format = var.open_api_spec_content_format\n    content_value  = var.open_api_spec_content_value\n  }\n}\n\nresource \"azurerm_api_management_product\" \"product\" {\n  product_id            = \"${random_pet.api_management.id}-product\"\n  resource_group_name   = azurerm_resource_group.rg.name\n  api_management_name   = azurerm_api_management.apim_service.name\n  display_name          = \"${random_pet.api_management.id}-product\"\n  subscription_required = true\n  approval_required     = false\n  published             = true\n  description           = \"An example Product\"\n}\n\nresource \"azurerm_api_management_group\" \"group\" {\n  name                = \"${random_pet.api_management.id}-group\"\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  display_name        = \"${random_pet.api_management.id}-group\"\n  description         = \"An example group\"\n}\n\nresource \"azurerm_api_management_product_api\" \"product_api\" {\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  product_id          = azurerm_api_management_product.product.product_id\n  api_name            = azurerm_api_management_api.api.name\n}\n\nresource \"azurerm_api_management_product_group\" \"product_group\" {\n  resource_group_name = azurerm_resource_group.rg.name\n  api_management_name = azurerm_api_management.apim_service.name\n  product_id          = azurerm_api_management_product.product.product_id\n  group_name          = azurerm_api_management_group.group.name\n}\n\nmain.tf:end\n###outputs.tf###\noutput \"resource_group_name\" {\n  value = azurerm_resource_group.rg.name\n}\n\noutput \"service_name\" {\n  description = \"The name of the API Management Service created\"\n  value       = azurerm_api_management.apim_service.name\n}\n\noutput \"api_name\" {\n  description = \"The name of the API Management Service API created\"\n  value       = azurerm_api_management_api.api.name\n}\n\noutput \"azurerm_api_management_product_id\" {\n  description = \"The name of the API Management Service Product created\"\n  value       = azurerm_api_management_product.product.product_id\n}\n\noutput \"azurerm_api_management_group_name\" {\n  description = \"The name of the API Management Service Group created\"\n  value       = azurerm_api_management_group.group.name\n}\n\noutput \"service_id\" {\n  description = \"The ID of the API Management Service created\"\n  value       = azurerm_api_management.apim_service.id\n}\n\noutput \"gateway_url\" {\n  description = \"The URL of the Gateway for the API Management Service\"\n  value       = azurerm_api_management.apim_service.gateway_url\n}\n\noutput \"service_public_ip_addresses\" {\n  description = \"The Public IP addresses of the API Management Service\"\n  value       = azurerm_api_management.apim_service.public_ip_addresses\n}\n\noutput \"api_outputs\" {\n  description = \"The IDs, state, and version outputs of the APIs created\"\n  value = {\n    id             = azurerm_api_management_api.api.id\n    is_current     = azurerm_api_management_api.api.is_current\n    is_online      = azurerm_api_management_api.api.is_online\n    version        = azurerm_api_management_api.api.version\n    version_set_id = azurerm_api_management_api.api.version_set_id\n  }\n}\n\noutput \"product_ids\" {\n  description = \"The ID of the Product created\"\n  value       = azurerm_api_management_product.product.id\n}\n\noutput \"product_api_ids\" {\n  description = \"The ID of the Product/API association created\"\n  value       = azurerm_api_management_product_api.product_api.id\n}\n\noutput \"product_group_ids\" {\n  description = \"The ID of the Product/Group association created\"\n  value       = azurerm_api_management_product_group.product_group.id\n}\n\noutputs.tf:end\n###providers.tf###\nterraform {\n  required_version = \">=1.0\"\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~>3.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~>3.0\"\n    }\n  }\n}\nprovider \"azurerm\" {\n  features {}\n}\nproviders.tf:end\n###README.md###\n## API Management\n\nDeploy an API Management service, containing an API based on a provided Open API spec, a Group, and a Product that is associated with both.\n\n## Terraform resource types\n\n- [random_pet](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet)\n- [azurerm_resource_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)\n- [azurerm_api_management](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management)\n- [azurerm_api_management_api](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management_api)\n- [azurerm_api_management_product](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management_product)\n- [azurerm_api_management_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management_group)\n- [azurerm_api_management_product_api](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management_product_api)\n- [azurerm_api_management_product_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/api_management_product_group)\n\n## Variables\n\n| Name | Description | Default |\n|-|-|-|\n| `resource_group_name_prefix` | Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription. | rg |\n| `resource_group_location` | Location of the resource group. | eastus |\n| `open_api_spec_content_format` | Content format from which the API Definition is imported. Possible values: openapi, openapi+json, openapi+json-link, openapi-link, swagger-json, swagger-link-json, wadl-link-json, wadl-xml, wsdl, wsdl-link | \"\" |\n| `open_api_spec_content_value` | Content from which the API Definition is imported. When a content_format of *-link-* is specified this must be a URL, otherwise this must be defined inline. | \"\" |\n\n## Example\n\n[Quickstart: Deploy an API Management service](https://learn.microsoft.com/azure/api-management/deploy-api-management-service-terraform)\n\nREADME.md:end\n###variables.tf###\nvariable \"resource_group_location\" {\n  type        = string\n  default     = \"eastus\"\n  description = \"Location of the resource group.\"\n}\n\nvariable \"resource_group_name_prefix\" {\n  type        = string\n  default     = \"rg\"\n  description = \"Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription.\"\n}\n\nvariable \"open_api_spec_content_format\" {\n  type        = string\n  default     = \"\"\n  description = \"The format of the content from which the API Definition should be imported. Possible values are: openapi, openapi+json, openapi+json-link, openapi-link, swagger-json, swagger-link-json, wadl-link-json, wadl-xml, wsdl and wsdl-link.\"\n  validation {\n    condition     = contains([\"openapi\", \"openapi+json\", \"openapi+json-link\", \"openapi-link\", \"swagger-json\", \"swagger-link-json\", \"wadl-link-json\", \"wadl-xml\", \"wsdl\", \"wsdl-link\"], var.open_api_spec_content_format)\n    error_message = \"open_api_spec_content_format must be one of the following: openapi, openapi+json, openapi+json-link, openapi-link, swagger-json, swagger-link-json, wadl-link-json, wadl-xml, wsdl and wsdl-link.\"\n  }\n}\n\nvariable \"open_api_spec_content_value\" {\n  type        = string\n  default     = \"\"\n  description = \"The Content from which the API Definition should be imported. When a content_format of *-link-* is specified this must be a URL, otherwise this must be defined inline.\"\n}\nvariables.tf:end\n"
    },
    {
        "role": "user",
        "content": "\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nprovider \"azurerm\" {\n  features {}\n}\n\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"${var.prefix}-resources\"\n  location = var.location\n}\n\nresource \"azurerm_storage_account\" \"example\" {\n  name                     = \"${var.prefix}stor\"\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = azurerm_resource_group.example.location\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n}\n\nresource \"azurerm_batch_account\" \"example\" {\n  name                                = \"${var.prefix}batch\"\n  resource_group_name                 = azurerm_resource_group.example.name\n  location                            = azurerm_resource_group.example.location\n  storage_account_id                  = azurerm_storage_account.example.id\n  storage_account_authentication_mode = \"StorageKeys\"\n}\n\nresource \"azurerm_batch_pool\" \"fixed\" {\n  name                = \"${var.prefix}-fixed-pool\"\n  resource_group_name = azurerm_resource_group.example.name\n  account_name        = azurerm_batch_account.example.name\n  display_name        = \"Fixed Scale Pool\"\n  vm_size             = \"Standard_A1\"\n  node_agent_sku_id   = \"batch.node.ubuntu 22.04\"\n\n  fixed_scale {\n    target_dedicated_nodes = 2\n    resize_timeout         = \"PT15M\"\n  }\n\n  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = \"latest\"\n  }\n\n  start_task {\n    command_line       = \"echo 'Hello World from $env'\"\n    task_retry_maximum = 1\n    wait_for_success   = true\n\n    common_environment_properties = {\n      env = \"TEST\"\n    }\n\n    user_identity {\n      auto_user {\n        elevation_level = \"NonAdmin\"\n        scope           = \"Task\"\n      }\n    }\n  }\n\n  metadata = {\n    \"tagName\" = \"Example tag\"\n  }\n}\n\nresource \"azurerm_batch_pool\" \"autopool\" {\n  name                = \"${var.prefix}-autoscale-pool\"\n  resource_group_name = azurerm_resource_group.example.name\n  account_name        = azurerm_batch_account.example.name\n  display_name        = \"Auto Scale Pool\"\n  vm_size             = \"Standard_A1\"\n  node_agent_sku_id   = \"batch.node.ubuntu 22.04\"\n\n  auto_scale {\n    evaluation_interval = \"PT15M\"\n\n    formula = <<EOF\n      startingNumberOfVMs = 1;\n      maxNumberofVMs = 25;\n      pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);\n      pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));\n      $TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);\nEOF\n  }\n\n  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = \"latest\"\n  }\n}\n\n## Example: Azure Batch\n\nThis example provisions the following Resources:\n\n## Creates\n\n1. A Resource Group\n2. A [Storage Account](https://docs.microsoft.com/en-us/azure/batch/batch-api-basics#azure-storage-account)\n3. A [Batch Account](https://docs.microsoft.com/en-us/azure/batch/batch-api-basics#account)\n4. Two [Batch pools](https://docs.microsoft.com/en-us/azure/batch/batch-api-basics#pool): one with fixed scale and the other with auto-scale\n\n## Usage\n\n- Provide values to all variables (credentials and names).\n- Create with `terraform apply`\n- Destroy all with `terraform destroy --force`\n\n## Example Usage with User Subscription mode\n\nIt's also possible to deploy Azure Batch Account in User Subscription mode. In this mode, all the machines that will be created by batch pools will be created in the user Azure subscription. In this mode, you need to specify a reference to an Azure Key Vault that will be used by Azure Batch to store and retrieve sensitive information. You can read more about User Subscription mode in Azure Batch on [this page](https://docs.microsoft.com/en-us/azure/batch/batch-api-basics#account).\n\n~> **NOTE:** the script below uses the also the [AzureAD provider](https://www.terraform.io/docs/providers/azuread/) to retrieve the \"Microsoft Azure Batch\" service principal information.\n\n\n```hcl\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"batch-rg\"\n  location = \"westeurope\"\n}\n\n# Get Microsoft Azure Batch service principal reference using the AzureAD provider\ndata \"azuread_service_principal\" \"batchsp\" {\n  display_name = \"Microsoft Azure Batch\"\n}\n\nresource \"azurerm_key_vault\" \"example\" {\n  name                            = \"batchkv\"\n  location                        = \"${azurerm_resource_group.example.location}\"\n  resource_group_name             = \"${azurerm_resource_group.example.name}\"\n  enabled_for_disk_encryption     = true\n  enabled_for_deployment          = true\n  enabled_for_template_deployment = true\n  tenant_id                       = \"00000000-0000-0000-0000-000000000002\"\n\n  sku_name = \"standard\"\n\n  access_policy {\n    tenant_id = \"00000000-0000-0000-0000-000000000002\"\n    object_id = \"${data.azuread_service_principal.batchsp.object_id}\"\n\n    secret_permissions = [\n      \"Get\",\n      \"List\",\n      \"Set\",\n      \"Delete\"\n    ]\n\n  }\n}\n\nresource \"azurerm_role_assignment\" \"contribrole\" {\n  scope                = \"/subscriptions/00000000-0000-0000-0000-000000000001\"\n  role_definition_name = \"Contributor\"\n  principal_id         = \"${data.azuread_service_principal.batchsp.object_id}\"\n}\n\nresource \"azurerm_batch_account\" \"example\" {\n  name                 = \"batchaccount\"\n  resource_group_name  = \"${azurerm_resource_group.example.name}\"\n  location             = \"${azurerm_resource_group.example.location}\"\n  storage_account_id   = \"${azurerm_storage_account.example.id}\"\n  pool_allocation_mode = \"UserSubscription\"\n  \n  # reference the Azure KeyVault\n  key_vault_reference {\n    id  = \"${azurerm_key_vault.example.id}\"\n    url = \"${azurerm_key_vault.example.vault_uri}\"\n  }\n}\n```\n\n# Copyright (c) HashiCorp, Inc.\n# SPDX-License-Identifier: MPL-2.0\n\nvariable \"prefix\" {\n  description = \"The prefix which should be used for all resources in this example\"\n}\n\nvariable \"location\" {\n  description = \"The Azure Region in which all resources in this example should be created.\"\n}\n"
    },
    {
        "role": "assistant",
        "content": "###main.tf###\nresource \"random_pet\" \"rg_name\" {\n  prefix = var.resource_group_name_prefix\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  location = var.resource_group_location\n  name     = random_pet.rg_name.id\n}\n\n# Generate random value for the storage account name\nresource \"random_string\" \"storage_account_name\" {\n  length  = 8\n  lower   = true\n  numeric = false\n  special = false\n  upper   = false\n}\n\nresource \"azurerm_storage_account\" \"example\" {\n  name                     = random_string.storage_account_name.result\n  resource_group_name      = azurerm_resource_group.rg.name\n  location                 = azurerm_resource_group.rg.location\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n}\n\n# Generate random value for the batch account name\nresource \"random_string\" \"batch_account_name\" {\n  length  = 8\n  lower   = true\n  numeric = false\n  special = false\n  upper   = false\n}\n\nresource \"azurerm_batch_account\" \"example\" {\n  name                                = random_string.batch_account_name.result\n  resource_group_name                 = azurerm_resource_group.rg.name\n  location                            = azurerm_resource_group.rg.location\n  storage_account_id                  = azurerm_storage_account.example.id\n  storage_account_authentication_mode = \"StorageKeys\"\n}\n\nresource \"random_pet\" \"azurerm_batch_pool_name\" {\n  prefix = \"pool\"\n}\n\nresource \"azurerm_batch_pool\" \"fixed\" {\n  name                = \"${random_pet.azurerm_batch_pool_name.id}-fixed-pool\"\n  resource_group_name = azurerm_resource_group.rg.name\n  account_name        = azurerm_batch_account.example.name\n  display_name        = \"Fixed Scale Pool\"\n  vm_size             = \"Standard_A1\"\n  node_agent_sku_id   = \"batch.node.ubuntu 22.04\"\n\n  fixed_scale {\n    target_dedicated_nodes = 2\n    resize_timeout         = \"PT15M\"\n  }\n\n  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = \"latest\"\n  }\n\n  start_task {\n    command_line       = \"echo 'Hello World from $env'\"\n    task_retry_maximum = 1\n    wait_for_success   = true\n\n    common_environment_properties = {\n      env = \"TEST\"\n    }\n\n    user_identity {\n      auto_user {\n        elevation_level = \"NonAdmin\"\n        scope           = \"Task\"\n      }\n    }\n  }\n\n  metadata = {\n    \"tagName\" = \"Example tag\"\n  }\n}\n\nresource \"azurerm_batch_pool\" \"autopool\" {\n  name                = \"${random_pet.azurerm_batch_pool_name.id}-autoscale-pool\"\n  resource_group_name = azurerm_resource_group.rg.name\n  account_name        = azurerm_batch_account.example.name\n  display_name        = \"Auto Scale Pool\"\n  vm_size             = \"Standard_A1\"\n  node_agent_sku_id   = \"batch.node.ubuntu 22.04\"\n\n  auto_scale {\n    evaluation_interval = \"PT15M\"\n\n    formula = <<EOF\n      startingNumberOfVMs = 1;\n      maxNumberofVMs = 25;\n      pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);\n      pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));\n      $TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);\nEOF\n  }\n\n  storage_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = \"latest\"\n  }\n}\nmain.tf:end\n###outputs.tf###\noutput \"resource_group_name\" {\n  value = azurerm_resource_group.rg.name\n}\n\noutput \"storage_account_name\" {\n  value = azurerm_storage_account.example.name\n}\n\noutput \"batch_account_name\" {\n  value = azurerm_batch_account.example.name\n}\n\noutput \"batch_pool_fixed_name\" {\n  value = azurerm_batch_pool.fixed.name\n}\n\noutput \"batch_pool_autopool_name\" {\n  value = azurerm_batch_pool.autopool.name\n}\n\noutputs.tf:end\n###providers.tf###\nterraform {\n  required_version = \">=1.0\"\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~>3.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~>3.0\"\n    }\n  }\n}\nprovider \"azurerm\" {\n  features {}\n}\nproviders.tf:end\n###README.md###\n# Azure Batch\n\nDeploy an Azure Batch account and two batch pools.\n\n## Terraform resource types\n\n- [random_pet](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet)\n- [azurerm_resource_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)\n- [random_string](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string)\n- [azurerm_storage_account](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account)\n- [azurerm_batch_account](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/batch_account)\n- [azurerm_batch_pool](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/batch_pool)\n\n## Variables\n\n| Name | Description | Default |\n|-|-|-|\n| `resource_group_name_prefix` | Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription. | rg |\n| `resource_group_location` | Location of the resource group. | eastus |\n\n## Example\n\n[Quickstart: Deploy an Azure Batch account](https://learn.microsoft.com/azure/batch/deploy-azure-batch-account-terraform)\n\nREADME.md:end\n###variables.tf###\nvariable \"resource_group_location\" {\n  type        = string\n  default     = \"eastus\"\n  description = \"Location of the resource group.\"\n}\n\nvariable \"resource_group_name_prefix\" {\n  type        = string\n  default     = \"rg\"\n  description = \"Prefix of the resource group name that's combined with a random ID so name is unique in your Azure subscription.\"\n}\nvariables.tf:end\n"
    },
    {
        "role": "user",
        "content": "\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"testbatch\"\n  location = \"West Europe\"\n}\n\nresource \"azurerm_storage_account\" \"example\" {\n  name                     = \"teststorage\"\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = azurerm_resource_group.example.location\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n}\n\nresource \"azurerm_batch_account\" \"example\" {\n  name                                = \"testbatchaccount\"\n  resource_group_name                 = azurerm_resource_group.example.name\n  location                            = azurerm_resource_group.example.location\n  pool_allocation_mode                = \"BatchService\"\n  storage_account_id                  = azurerm_storage_account.example.id\n  storage_account_authentication_mode = \"StorageKeys\"\n\n  tags = {\n    env = \"test\"\n  }\n}"
    }
]